---
title: "Counts analisys"
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r setup}
library(PEPI)
library(cmdstanr)
library(rstan)
library(dplyr)
library(ggplot2)
```

We load a time series of cell counts generated with rRACES

```{r}
set.seed(2010)
counts
```

We create a PEPI object of counts type
```{r}

x = init_counts(counts)
x
```


We fit cell counts 
```{r}

x = fit_counts(
  x,
  cmdstan_path = cmdstanr::cmdstan_path(),
  ndraws = 5000,
  seed = 1000,
  alpha_n = 0.5,
  beta_n = 2,
  alpha_p = 0.2,
  beta_p = 10,
  alpha_lambda = 1,
  beta_lambda = 1,
  ms_epi = 0.1,
  sigma_epi = 0.5
)

print(x)

```



We get and plot average counts 
```{r}

x = get_average_counts(x)
plot_counts(x)

```


We plot the posterior of growth rates and effective switching rates
```{r}

x = get_posterior(x)
plot_inference(x,params = c("lambda_minus","s_epi","omega_p","omega_n"))
```

